-- Link layer for communication between models

-- Only needed in craftos-PC
periphemu.create("left", "modem")

ids = {}
ids.smeltery = nil

local fnc_callback = nil

function init(side, callback)
    fnc_callback = callback
    rednet.open(side)
end

function discovery()
    rednet.broadcast("discovery")
end

function handle_message(id, message)
    print(message)
    if message == "Requesting link" then
        print("Link requested from "..id)
        rednet.send(id, "discovery")
        return
    end
    if message == "Smeltery link" then
        print("Smeltery is linked")
        rednet.send(id, "discovery")
        ids.smeltery = id
        return
    end

    if fnc_callback ~= nil then
        fnc_callback(id, message)
    end

end

function send_command(id, message)
    if id ~= nil then
        rednet.send(id, message)
    end
end